<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ”¥ Reborn Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.1/dist/umd/supabase.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-600 to-purple-600 h-screen flex flex-col text-white">

  <!-- Header -->
  <header class="flex justify-between items-center p-4 bg-black bg-opacity-30">
    <h1 class="text-2xl font-bold">ðŸ”¥ Reborn Dashboard</h1>
    <button id="logout" class="bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600">Logout</button>
  </header>

  <!-- Chat Area -->
  <main class="flex-1 flex flex-col justify-between p-4">
    <div id="chatBox" class="flex-1 overflow-y-auto bg-white bg-opacity-10 rounded-lg p-3 mb-3"></div>
    <div class="flex space-x-2">
      <input id="messageInput" type="text" placeholder="Type a message..." class="flex-1 px-4 py-2 rounded-lg text-black">
      <button id="sendBtn" class="bg-green-500 px-4 py-2 rounded-lg hover:bg-green-600">Send</button>
    </div>
  </main>

  <script>
    // ðŸ§  Supabase Config (á€á€»á€…á€ºá€˜á€±á€¬á€·á€…á€ºá€›á€²á€· project á€€á€­á€¯á€–á€¼á€Šá€·á€ºá€•á€«)
    const SUPABASE_URL = "https://YOUR-PROJECT-URL.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ðŸŒŸ Current user info
    const currentUser = JSON.parse(localStorage.getItem("user"));
    if (!currentUser) window.location.href = "index.html";

    const chatBox = document.getElementById("chatBox");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const logoutBtn = document.getElementById("logout");

    // Default Channel ID (for now)
    const defaultChannel = "global-room";

    // ðŸ“¡ Load messages
    async function loadMessages() {
      const { data, error } = await supabaseClient
        .from("chat_messages")
        .select("*")
        .eq("channel_id", defaultChannel)
        .order("created_at", { ascending: true });

      if (!error && data) {
        chatBox.innerHTML = "";
        data.forEach(msg => {
          const bubble = document.createElement("div");
          const isMine = msg.sender_id === currentUser.id;
          bubble.className = isMine
            ? "text-right mb-2"
            : "text-left mb-2";
          bubble.innerHTML = `
            <div class="${isMine ? 'bg-green-500' : 'bg-gray-500'} inline-block px-3 py-2 rounded-lg">
              <b>${isMine ? "You" : msg.sender_id}</b>: ${msg.content}
            </div>`;
          chatBox.appendChild(bubble);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }

    // âœ‰ï¸ Send message
    sendBtn.onclick = async () => {
      const content = messageInput.value.trim();
      if (!content) return;

      const { error } = await supabaseClient
        .from("chat_messages")
        .insert({
          channel_id: defaultChannel,
          sender_id: currentUser.id,
          content
        });

      if (!error) {
        messageInput.value = "";
      }
    };

    // ðŸ”„ Realtime listener
    supabaseClient
      .channel("chat_room")
      .on(
        "postgres_changes",
        { event: "*", schema: "public", table: "chat_messages" },
        payload => {
          loadMessages();
        }
      )
      .subscribe();

    // ðŸšª Logout
    logoutBtn.onclick = () => {
      localStorage.removeItem("user");
      window.location.href = "index.html";
    };

    // ðŸ”¥ Initialize
    loadMessages();
  </script>
</body>
</html>
